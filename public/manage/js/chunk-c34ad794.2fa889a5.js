(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c34ad794"],{"04dc":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"box box-primary play-backs"},[n("a-spin",{attrs:{tip:"Loading...",spinning:t.loading}},[n("div",{staticClass:"spin-content"},[n("div",{staticClass:"box-header"},[t.ipc?n("h2",{staticClass:"text-primary text-center"},[t._v("云端录像("+t._s(t.ipc.channel_name)+")-时间轴视图")]):t._e()]),n("div",{staticClass:"box-body"},[n("div",{staticClass:"form-inline",attrs:{autocomplete:"off",spellcheck:"false"}},[n("div",{staticClass:"form-group pull-right"},[n("div",{staticClass:"input-group input-group-sm"},[n("a-date-picker",{staticClass:"playback-date",on:{change:t.onDateChange},model:{value:t.queryParams.date,callback:function(e){t.$set(t.queryParams,"date",e)},expression:"queryParams.date"}}),n("a-button",{attrs:{type:"default",icon:"download",loading:t.downloadLoading,disabled:""===t.videoUrl},on:{click:t.download}}),n("div",{staticClass:"input-group-btn"})],1)])]),n("div",{staticClass:"clearfix"}),n("EasyPlayer",{ref:"recorder",attrs:{"video-title":"录像回放",videoUrl:t.videoUrl,aspect:t.aspect,onDemand:!0,autoplay:t.autoplay,muted:t.muted,currentTime:t.currentTime,"element-loading-text":"加载中...","element-loading-background":"#000",fluent:t.fluent,stretch:t.stretch},on:{ended:t.onPlayEnded,play:t.onPlay,error:t.onPlayError,timeupdate:t.onPlayTimeUpdate}}),n("div",{staticClass:"clearfix"}),n("playback-bar",{attrs:{initDate:t.currentDate,timeData:t.timeData},on:{timechange:t.onPlaybackBarTimeChange}}),n("br")],1)])])],1)},r=[],o=n("1da1"),a=(n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0"),n("06c5"));function s(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Object(a["a"])(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){c=!0,o=t},f:function(){try{s||null==n["return"]||n["return"]()}finally{if(c)throw o}}}}n("d81d"),n("2b3d"),n("9861"),n("96cf");var c=n("c1df"),u=n.n(c),d=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},l=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"playbackbar",attrs:{id:"playbackbar_div"}},[n("canvas",{attrs:{id:"playbackbar"}})])}],f=(n("a9e3"),n("4de4"),{components:{},props:{initDate:{type:String},timeData:{type:Array,default:function(){return[]}}},data:function(){return{nowDate:"",mouseNowDate:"",ctx:null,_width:0,_height:0,isMouseDown:!1,mousedownX:0,mousedownY:0,size:160,axisTick:1}},watch:{initDate:function(){this.nowDate=this.initDate,this.initCanvas()}},computed:{pxToSecond:function(){return 60*this.axisTick*60/this.size}},mounted:function(){var t=this;this.nowDate=this.initDate,this.initCanvas(),this.onDocumentEvent();var e=!1;window.onresize=function(){e||(e=!0,setTimeout((function(){t.initCanvas(),e=!1}),300))}},beforeDestroy:function(){window.onresize=null,document.onmousemove=null,document.onmouseup=null},methods:{initCanvas:function(){var t=document.getElementById("playbackbar_div");this._width=t.offsetWidth,this._height=t.offsetHeight;var e=document.getElementById("playbackbar");e.width=this._width,e.height=this._height,this.ctx=e.getContext("2d"),this.onBaseFill(this.ctx,this._width,this._height),this.onDrawNowDate(this.ctx,this._width),this.onMouseHandle(e,this.ctx,this._width,this._height)},onBaseFill:function(t,e,n){t.beginPath(),t.strokeStyle="#303030",t.lineWidth=3,t.moveTo(0,40.5),t.lineTo(e,40.5),t.stroke(),this.onDrawTick(t,e,n),this.onDrawRecordArea(t,e,n),t.beginPath(),t.strokeStyle="#B1BE76",t.lineWidth=1,t.moveTo(0,42.5),t.lineTo(e,42.5),t.stroke(),t.beginPath(),t.strokeStyle="#FFFF00",t.lineWidth=1,t.moveTo(0,50.5),t.lineTo(e,50.5),t.stroke(),t.beginPath(),t.strokeStyle="#ffcc00",t.lineWidth=2,t.moveTo(e/2-1+.5,0),t.lineTo(e/2-1+.5,n),t.stroke()},onDrawTick:function(t,e,n){for(var i=new Date(this.nowDate).getTime(),r=new Date(u()(this.nowDate).format("YYYY-MM-DD HH")+":00:00").getTime(),o=u()(this.nowDate).format("HH"),a=(i-r)/1e3,s=a/this.pxToSecond,c=e/2-1-s,d=Math.floor(c/this.size),l=Math.floor((e-c)/this.size),f=0;f<=d;f++){var m=c-f*this.size,h=Number(o)-f;h<0&&(h+=24);var v=h<10?"0".concat(h,":00"):"".concat(h,":00");t.beginPath(),t.strokeStyle="#4B4B4B",t.lineWidth=2,t.moveTo(m+.5,40),t.lineTo(m+.5,n),t.stroke(),t.font="10px Arial",t.fillStyle="#969696",t.fillText(v,m+.5-12,34)}for(var p=1;p<=l;p++){var b=c+p*this.size,g=Number(o)+p;g>=24&&(g-=24);var D=g<10?"0".concat(g,":00"):"".concat(g,":00");t.beginPath(),t.strokeStyle="#4B4B4B",t.lineWidth=2,t.moveTo(b+.5,40),t.lineTo(b+.5,n),t.stroke(),t.font="10px Arial",t.fillStyle="#969696",t.fillText(D,b+.5-12,34)}},onDrawNowDate:function(t,e){t.font="14px Arial",t.fillStyle="#ffffff",t.fillText(this.nowDate,e/2-75,24)},onDrawRecordArea:function(t,e,n){var i=this,r=new Date(this.nowDate).getTime(),o=r/1e3-e/2*this.pxToSecond,a=r/1e3+e/2*this.pxToSecond,s=this.timeData.filter((function(t){var e=new Date(t.startTime).getTime()/1e3,n=new Date(t.endTime).getTime()/1e3;return e<o&&n>o||e>=o&&e<a}));s.map((function(n){var r=new Date(n.startTime).getTime()/1e3,s=new Date(n.endTime).getTime()/1e3;if(r<o){var c=s<a?(s-o)/i.pxToSecond:e;t.beginPath(),t.fillStyle="#637DEC",t.fillRect(0,43,c,8)}if(r>=o){var u=(r-o)/i.pxToSecond,d=(s-r)/i.pxToSecond;t.beginPath(),t.fillStyle="#637DEC",t.fillRect(u,43,d,8)}}))},onMouseHandle:function(t,e,n,i){var r=this;t.onmouseover=function(t){r.isMouseDown||(r.mouseNowDate=r.nowDate)},t.onmouseout=function(t){e.clearRect(0,0,n,i),r.onBaseFill(e,n,i),r.onDrawNowDate(e,n)},t.onmousemove=function(t){if(!r.isMouseDown){e.clearRect(0,0,n,i),r.onBaseFill(e,n,i);var o=t.offsetX,a=o-n/2,s=new Date(r.mouseNowDate).getTime(),c=u()(s+r.pxToSecond*a*1e3).format("YYYY-MM-DD HH:mm:ss");e.font="12px Arial",e.fillStyle="#ffffff",e.fillText(c,o-62,12),r.onDrawNowDate(e,n)}},t.onmousedown=function(t){r.mousedownX=t.clientX,r.mousedownY=t.clientY,r.isMouseDown=!0}},onDocumentEvent:function(){var t=this;document.onmouseup=function(e){t.isMouseDown&&(t.mouseNowDate=t.nowDate,t.isMouseDown=!1)},document.onmousemove=function(e){if(t.isMouseDown){t.ctx.clearRect(0,0,t._width,t._height),t.onBaseFill(t.ctx,t._width,t._height);var n=e.clientX,i=new Date(t.mouseNowDate).getTime(),r=t.mousedownX-n;t.nowDate=u()(i+t.pxToSecond*r*1e3).format("YYYY-MM-DD HH:mm:ss"),t.onDrawNowDate(t.ctx,t._width),t.$emit("timechange",t.nowDate)}}}}}),m=f,h=(n("a241"),n("2877")),v=Object(h["a"])(m,d,l,!1,null,"376f5132",null),p=v.exports,b=n("7987"),g=n.n(b),D=n("aa98"),w=n("e5bf"),y={date:u()(),record_date:u()().format("YYYY-MM-DD"),main_id:void 0},T={name:"PlayBack",data:function(){return{files:[],videoUrls:[],videoUrl:"",mode:"4",aspect:"16:9",muted:!0,autoplay:!0,fluent:!1,stretch:!1,currentTime:0,currentDate:"",timeData:[],name:"",ipc:null,queryParams:Object.assign(y,{}),loading:!0,minutesPerUnit:1,downloadLoading:!1,timer:null}},components:{EasyPlayer:g.a,PlaybackBar:p},mounted:function(){this.initDate(),this.initData(),this.clearTimer(),this.timer=setInterval(this.getRecordFiles,12e4)},beforeDestroy:function(){this.clearTimer(),y.date=u()(),y.record_date=u()().format("YYYY-MM-DD"),this.queryParams=Object.assign(y,{}),this.$refs.recorder.destroyPlayer()},computed:{id:function(){return this.$route.params.id},activeMinutes:function(){var t,e={},n=s(this.files);try{for(n.s();!(t=n.n()).done;){var i=t.value,r=1e3*i.start_time,o=u()(r),a=u()(r),c=parseInt(i.duration);if(!(c<=0||c>36e3)){var d=a.unix();d-=d%(60*this.minutesPerUnit);var l=u.a.unix(d);if(o.isSame(l,"day")){var f=l.format("HH:mm"),m=void 0,h=void 0;this.start&&(m=u()(o).startOf("day").add(this.start,"minute")),this.end&&(h=u()(o).startOf("day").add(this.end,"minute")),e[f]=Object.assign({current_time:0},i),m&&a.isBefore(m,"minute")&&delete e[f],h&&a.isAfter(h,"minute")&&delete e[f];for(var v=1;v<=c;v++)if(a.add(1,"seconds"),!m||!a.isBefore(m,"minute")){if(h&&a.isAfter(h,"minute"))break;if(d=a.unix(),d-=d%(60*this.minutesPerUnit),l=u.a.unix(d),o.isSame(l,"day")){var p=l.format("HH:mm");p!=f&&(f=p,e[f]=Object.assign({current_time:v},i))}}}}}}catch(b){n.e(b)}finally{n.f()}return e}},methods:{onPlay:function(t){},onPlayEnded:function(){var t=this.videoUrls.indexOf(this.videoUrl),e=0;t>=0&&(e=t>=this.files.length-1?t:t+1);var n=this.files[e];console.log("index:",e),console.log("index video:",n),n.download_url!==this.videoUrl?this.videoUrl=n.download_url:console.log("与刚播放完的视频地址一样")},onPlayError:function(t){console.log("onPlayError:",t)},onPlayTimeUpdate:function(t){if(!(t<1)){var e=this.videoUrls.indexOf(this.videoUrl);if(e>=0&&e<this.files.length){var n=this.files[e],i=u()(1e3*n.start_time);i.add(t,"seconds"),this.currentDate=i.format("YYYY-MM-DD HH:mm:ss")}}},initData:function(){var t=this;this.loading=!0,this.getIpc(),setTimeout((function(){t.loading=!1}),500)},getIpc:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(D["u"])(t.id);case 2:t.ipc=e.sent,t.ipc&&(t.queryParams.main_id=t.ipc.main_id,setTimeout((function(){t.getRecordFiles()}),200));case 4:case"end":return e.stop()}}),e)})))()},getRecordFiles:function(){var t=arguments,e=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var i,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=t.length>0&&void 0!==t[0]&&t[0],i&&(e.loading=!0),n.next=4,Object(w["g"])(e.queryParams);case 4:e.files=n.sent,e.files.length?(e.videoUrls=e.files.map((function(t){return t.download_url})),r=e.files[e.files.length-1]["download_url"],e.videoUrl!==r&&(e.videoUrl=r),e.currentDate=u()(1e3*e.files[0]["start_time"]).format("YYYY-MM-DD HH:mm:ss"),e.timeData=e.files.map((function(t){return{startTime:u()(1e3*t.start_time).format("YYYY-MM-DD HH:mm:ss"),endTime:u()(1e3*t.end_time).format("YYYY-MM-DD HH:mm:ss")}}))):(e.videoUrl="",e.timeData=[]),i&&setTimeout((function(){e.loading=!1}),500);case 7:case"end":return n.stop()}}),n)})))()},initDate:function(){this.currentDate=this.queryParams.date.format("YYYY-MM-DD HH:mm:ss")},onDateChange:function(t,e){this.queryParams.date=t,this.queryParams.record_date=e,this.initDate(),this.getRecordFiles(!0)},onPlaybackBarTimeChange:function(t){var e=u()(t).format("YYYY-MM-DD"),n=this.queryParams.date.format("YYYY-MM-DD");e<n&&(this.queryParams.date=u()(t));var i=this.activeMinutes,r=u()(t).format("HH:mm");if(i.hasOwnProperty(r)){var o=i[r]["download_url"];o!==this.videoUrl&&(this.videoUrl=o),this.currentTime=i[r]["current_time"]}else this.videoUrl=""},download:function(){var t=this;this.downloadLoading=!0,fetch(this.videoUrl).then((function(t){return t.blob()})).then((function(e){var n=document.createElement("a"),i=window.URL.createObjectURL(e);n.download=name,n.href=i,n.click(),window.URL.revokeObjectURL(i),t.downloadLoading=!1}))},clearTimer:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},filters:{filterTime:function(t){return u()(t).format("YYYY-MM-DD HH:mm")},statusTypeFilter:function(t){var e={false:"warning",true:"success"};return e[t]}},watch:{currentDate:function(t,e){}}},P=T,Y=(n("7443"),n("b304"),Object(h["a"])(P,i,r,!1,null,"2df0b31f",null));e["default"]=Y.exports},3243:function(t,e,n){},"722d":function(t,e,n){},7443:function(t,e,n){"use strict";n("3243")},a241:function(t,e,n){"use strict";n("722d")},aa98:function(t,e,n){"use strict";n.d(e,"y",(function(){return r})),n.d(e,"t",(function(){return o})),n.d(e,"l",(function(){return a})),n.d(e,"r",(function(){return s})),n.d(e,"o",(function(){return c})),n.d(e,"s",(function(){return u})),n.d(e,"q",(function(){return d})),n.d(e,"n",(function(){return l})),n.d(e,"m",(function(){return f})),n.d(e,"e",(function(){return m})),n.d(e,"k",(function(){return h})),n.d(e,"h",(function(){return v})),n.d(e,"a",(function(){return p})),n.d(e,"f",(function(){return b})),n.d(e,"g",(function(){return g})),n.d(e,"d",(function(){return D})),n.d(e,"p",(function(){return w})),n.d(e,"i",(function(){return y})),n.d(e,"j",(function(){return T})),n.d(e,"w",(function(){return P})),n.d(e,"c",(function(){return Y})),n.d(e,"z",(function(){return _})),n.d(e,"A",(function(){return x})),n.d(e,"x",(function(){return k})),n.d(e,"v",(function(){return M})),n.d(e,"b",(function(){return S})),n.d(e,"u",(function(){return U}));var i=n("28de");function r(t){return i["b"].promisePost("device/saveBindPartner",t)}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["b"].get("device/unboundPartnerDevices",{params:t})}function a(t,e){return i["b"].promisePost("device/editNvr",e,{params:{id:t}})}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["b"].get("device/nvrDevices",{params:t})}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["b"].get("device/ipcDevices",{params:t})}function u(){return i["b"].get("device/statusItems")}function d(t){return i["b"].get("device/nvrShow",{params:{id:t}})}function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["b"].promiseGet("device/registerLogs",{params:t})}function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["b"].promiseGet("device/activeLogs",{params:t})}function m(t){return i["b"].post("device/batchDeleteIpc",{ids:t})}function h(t,e){return i["b"].promisePost("device/editIpc",e,{params:{id:t}})}function v(t){return i["b"].post("device/batchSyncIpc",{ids:t})}function p(t){return i["b"].post("device/batchActiveIpc",{ids:t})}function b(t){return i["b"].post("device/batchLockIpc",{ids:t})}function g(t){return i["b"].post("device/batchOpenLiveIpc",{ids:t})}function D(t){return i["b"].post("device/batchCloseLiveIpc",{ids:t})}function w(){return i["b"].get("device/mediaServerList")}function y(t,e){return i["b"].post("device/batchUpdateMediaServer",{ids:t,mediaServerId:e})}function T(t,e){return i["b"].post("device/batchUpdateRtpProto",{ids:t,rtp_proto:e})}function P(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["b"].get("device/nvrItems",{params:t})}function Y(t,e){return i["b"].post("device/batchBindRecorder",{ids:t,recorderId:e})}function _(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["b"].get("device/videoOnlineList",{params:t})}function x(t,e){return i["b"].get("device/videoCover",{params:{mediaServerId:t,url:e}})}function k(t,e){return i["b"].post("device/ptzCtrl",{main_id:t,command_type:e})}function M(t){return i["b"].post("device/liveUrl",{main_id:t})}function S(t,e){return i["b"].promisePost("device/batchBindRecordPlan",{ids:t,planId:e})}function U(t){return i["b"].get("device/ipcShow",{params:{id:t}})}},b304:function(t,e,n){"use strict";n("b6d1")},b6d1:function(t,e,n){},e5bf:function(t,e,n){"use strict";n.d(e,"j",(function(){return r})),n.d(e,"a",(function(){return o})),n.d(e,"e",(function(){return a})),n.d(e,"h",(function(){return s})),n.d(e,"d",(function(){return c})),n.d(e,"i",(function(){return u})),n.d(e,"f",(function(){return d})),n.d(e,"g",(function(){return l})),n.d(e,"k",(function(){return f})),n.d(e,"l",(function(){return m})),n.d(e,"b",(function(){return h})),n.d(e,"c",(function(){return v}));var i=n("28de");function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["b"].get("record/plans",{params:t})}function o(t){return i["b"].promisePost("record/addPlan",t)}function a(t,e){return i["b"].promisePost("record/editPlan",e,{params:{id:t}})}function s(t){return i["b"].get("record/plan",{params:{id:t}})}function c(t){return i["b"].promisePost("record/delPlan",{id:t})}function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["b"].get("record/planItems",{params:t})}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["b"].get("record/recordChannels",{params:t})}function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["b"].get("record/files",{params:t})}function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i["b"].get("record/summary",{params:t})}function m(t){return i["b"].promisePost("record/startPlayBack",{video_id:t})}function h(t){return i["b"].promisePost("record/closePlayBack",{video_id:t})}function v(t){return i["b"].promisePost("record/delPlayBack",{video_id:t})}}}]);
//# sourceMappingURL=chunk-c34ad794.2fa889a5.js.map