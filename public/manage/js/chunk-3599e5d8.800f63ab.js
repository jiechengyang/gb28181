(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3599e5d8"],{"0376":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return!e.isCheck||e.currentBtnRoute?n("div",{staticClass:"permission-button"},["tab"===e.type&&e.routeLink?n("div",[n("router-link",{attrs:{to:e.routeLink}},[e._v(e._s(e.title))])],1):e._e(),"modal"===e.type?n("div",[e.useBtnTag?n("a-button",{attrs:{type:e.btnType,icon:e.icon,disabled:e.disabled,loading:e.loading},on:{click:function(){e.$emit("handle-click")}}},[e._v(e._s(e.title))]):n("span",{class:e.classname?e.classname:"edit-btn",on:{click:function(){e.$emit("handle-click")}}},[e._v(" "+e._s(e.title))])],1):e._e(),"confirm"===e.type?n("div",[n("span",{class:e.classname?e.classname:"del-btn",on:{click:function(){e.$emit("handle-confirm")}}},[e._v(" "+e._s(e.title))])]):e._e()]):e._e()},i=[],r=n("90fe"),s={name:"PermissionButton",props:{routeLink:null,type:{type:String,default:"modal"},code:{type:String,default:""},title:{type:String,default:""},loading:{type:Boolean,default:!1},icon:{type:String,default:"plus"},useBtnTag:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},classname:{type:String,default:""},btnType:{type:String,default:"primary"},isCheck:{type:Boolean,default:!0},confirm:{type:Boolean,default:!1}},data:function(){return{currentBtnRoute:null}},mounted:function(){this.checkPermission()},methods:{checkPermission:function(){if(this.isCheck){var e=this.$store.state.vueRouters.vueRouters;this.code&&e&&(this.currentBtnRoute=Object(r["j"])(e,this.code))}},handleClick:function(e){this.$emit("bclick")}}},o=s,c=(n("226f"),n("2877")),l=Object(c["a"])(o,a,i,!1,null,"3750c8b8",null);t["a"]=l.exports},"226f":function(e,t,n){"use strict";n("d754")},2907:function(e,t,n){"use strict";n("c486")},"3a57":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"record-container"},[e.isTopView?n("div",{staticClass:"plan-body"},[n("a-card",{staticStyle:{"margin-top":"24px"},attrs:{bordered:!1,tabList:e.tabList,activeTabKey:e.activeTabKey},on:{tabChange:e.onTabChange}},[n("div",{directives:[{name:"show",rawName:"v-show",value:"1"===e.activeTabKey,expression:"activeTabKey === '1'"}],staticClass:"record-plan"},[n("div",{staticClass:"table-operator"},[n("div",{staticClass:"pull-left"},[n("a-form",{attrs:{layout:"inline"}},[n("a-form-item",{attrs:{label:"关键字"}},[n("a-input-search",{staticStyle:{width:"250px"},attrs:{placeholder:"输入关键字","enter-button":"","allow-clear":""},on:{search:e.onChange},model:{value:e.queryParams.keywords,callback:function(t){e.$set(e.queryParams,"keywords",t)},expression:"queryParams.keywords"}})],1)],1)],1),n("div",{staticClass:"pull-right"},[n("permission-button",{attrs:{code:"record-plans-create",title:"添加录像计划",type:"modal",btnType:"Primary",icon:"plus",disabled:e.disabled},on:{"handle-click":e.handleAddPlan}})],1)]),n("a-table",{ref:"table1",attrs:{columns:e.plansColumns,dataSource:e.plans,pagination:!1,loading:e.loading,rowSelection:e.rowSelection,locale:e.localePlan,rowKey:"id"},scopedSlots:e._u([{key:"status",fn:function(t,a){return[n("a-badge",{attrs:{status:e._f("statusTypeFilter")(t),text:a.status_text}})]}},{key:"time",fn:function(t){return n("span",{},[e._v(e._s(e._f("filterTime")(t,t)))])}},{key:"operation",fn:function(t,a){return[n("permission-button",{attrs:{code:"record-plans-summary",isCheck:!1,title:"录像统计",type:"modal",useBtnTag:!1},on:{"handle-click":function(t){return e.handlePlanSummary(a.id)}}}),n("permission-button",{attrs:{code:"record-plans-update",isCheck:!1,title:"编辑",type:"modal",useBtnTag:!1},on:{"handle-click":function(t){return e.handlePlanEdit(a.id)}}}),n("permission-button",{attrs:{code:"record-plans-delete",isCheck:!1,title:"删除",type:"confirm"},on:{"handle-confirm":function(t){return e.delPlan(a.id)}}})]}}],null,!1,3458483415)}),n("lz-pagination",{attrs:{page:e.paginator,autoPush:!1},on:{change:e.changePaginator,showSizeChange:e.showSizeChange}})],1),n("div",{directives:[{name:"show",rawName:"v-show",value:"2"===e.activeTabKey,expression:"activeTabKey === '2'"}],staticClass:"record-playback"},[n("div",{staticClass:"table-operator"},[n("div",{staticClass:"pull-left"},[n("a-form",{attrs:{layout:"inline"}},[n("a-form-item",{attrs:{label:"录像状态"}},[n("a-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择","default-value":"1"},on:{change:e.refresh},model:{value:e.queryParams.record_status,callback:function(t){e.$set(e.queryParams,"record_status",t)},expression:"queryParams.record_status"}},[n("a-select-option",{attrs:{value:""}},[e._v("全部")]),n("a-select-option",{attrs:{value:"0"}},[e._v("未录像")]),n("a-select-option",{attrs:{value:"1"}},[e._v("录像中")]),n("a-select-option",{attrs:{value:"-1"}},[e._v("关闭录像")])],1)],1),n("a-form-item",{attrs:{label:"关键字"}},[n("a-input-search",{staticStyle:{width:"250px"},attrs:{placeholder:"输入关键字","enter-button":"","allow-clear":""},on:{search:e.onChange},model:{value:e.queryParams.keywords,callback:function(t){e.$set(e.queryParams,"keywords",t)},expression:"queryParams.keywords"}})],1)],1)],1)]),n("a-table",{ref:"table2",attrs:{columns:e.playbackColumns,dataSource:e.playBacks,pagination:!1,loading:e.loading,rowSelection:e.rowSelection,locale:e.localePlayBack,rowKey:"id"},scopedSlots:e._u([{key:"time",fn:function(t){return n("span",{},[e._v(e._s(e._f("filterTime")(t,t)))])}},{key:"operation",fn:function(t,a){return[n("permission-button",{attrs:{code:"record-playback-view",title:"查看录像",isCheck:!1,routeLink:"/resource/record-playback/"+a.id+"/view",type:"tab"}}),n("permission-button",{directives:[{name:"show",rawName:"v-show",value:1==a.record_status,expression:"record.record_status == 1"}],attrs:{code:"record-playback-stop",isCheck:!1,title:"关闭录像",type:"confirm"},on:{"handle-confirm":function(t){return e.closePlayBack(a.id)}}}),n("permission-button",{directives:[{name:"show",rawName:"v-show",value:[0,-1].includes(parseInt(a.record_status)),expression:"[0, -1].includes(parseInt(record.record_status))"}],attrs:{code:"record-playback-start",isCheck:!1,title:"开启录像",type:"confirm"},on:{"handle-confirm":function(t){return e.startPlayBack(a.id)}}}),n("permission-button",{attrs:{code:"record-playback-delete",isCheck:!1,title:"清空录像",type:"confirm"},on:{"handle-confirm":function(t){return e.delPlayBack(a.id)}}})]}}],null,!1,398252862)}),n("lz-pagination",{attrs:{page:e.paginator,autoPush:!1},on:{change:e.changePaginator,showSizeChange:e.showSizeChange}})],1)]),n("plan-form",{ref:"recordFormModal",attrs:{visible:e.visible,loading:e.confirmLoading},on:{cancel:e.handleCancel,ok:e.handleOk}}),n("plan-summary",{ref:"summaryModal",attrs:{visible:e.visibleSummary,loading:e.summaryLoading},on:{cancel:function(t){e.visibleSummary=!1},ok:function(t){e.visibleSummary=!1}}})],1):n("router-view")],1)},i=[],r=n("1da1"),s=(n("96cf"),n("d3b7"),n("3ca3"),n("ddb0"),n("c1df")),o=n.n(s),c=n("e5bf"),l=n("0376"),u=n("d613"),d={keywords:"",status:void 0,record_status:void 0,offset:1,limit:20},f={name:"RecordManage",data:function(){return{visible:!1,confirmLoading:!1,visibleSummary:!1,summaryLoading:!1,disabled:!1,tabList:[{key:"1",tab:"录像计划"},{key:"2",tab:"录像回放"}],localePlan:{filterConfirm:"确定",filterReset:"重置",emptyText:"暂无计划"},localePlayBack:{filterConfirm:"确定",filterReset:"重置",emptyText:"暂无回放"},plansColumns:[{title:"名称",dataIndex:"name",key:"name",width:150},{title:"状态",dataIndex:"status",key:"status",scopedSlots:{customRender:"status"},width:150},{title:"天数限制",dataIndex:"limit_days",key:"limit_days",width:150},{title:"空间大小限制(GB)",dataIndex:"limit_space",key:"limit_space",width:150},{title:"超出后关闭计划",dataIndex:"over_step_text",key:"over_step_text",width:150},{title:"计划明细",dataIndex:"plan_range_text",key:"plan_range_text",width:300},{title:"更新时间",dataIndex:"updated_time",key:"updated_time",scopedSlots:{customRender:"time"},width:150},{title:"创建时间",dataIndex:"created_Time",key:"created_Time",scopedSlots:{customRender:"time"},width:150},{title:"操作",dataIndex:"operation",fixed:"right",scopedSlots:{customRender:"operation"}}],plans:[],playbackColumns:[{title:"设备国标ID",dataIndex:"device_id",key:"device_id"},{title:"设备国标通道ID",dataIndex:"channel_id",key:"channel_id"},{title:"通道名称",dataIndex:"channel_name",key:"channel_name"},{title:"关联计划",dataIndex:"record_plan_name",key:"record_plan_name"},{title:"录制状态",dataIndex:"record_status_text",key:"record_status_text"},{title:"更新时间",dataIndex:"updated_time",key:"updated_time",scopedSlots:{customRender:"time"}},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"}}],playBacks:[],loading:!1,selectedRowKeys:[],selectedRows:[],queryParams:Object.assign(d,{}),paginator:null}},components:{PermissionButton:l["a"],LzPagination:u["a"],PlanForm:function(){return n.e("chunk-fec557b4").then(n.bind(null,"65e2"))},PlanSummary:function(){return n.e("chunk-91a0e2c8").then(n.bind(null,"c51c"))}},mounted:function(){this.isTopView&&this.loadData()},computed:{activeTabKey:{get:function(){return this.$store.state.tab.record_tab_active_key},set:function(e){this.$store.commit("SET_RECORD_TAB",e)}},isTopView:function(){return"/resource/record-plans"===this.$route.path},rowSelection:function(){return{selectedRowKeys:this.selectedRowKeys,onChange:this.onSelectChange}}},methods:{showSizeChange:function(e,t){this.queryParams=Object.assign(this.queryParams,{offset:e,limit:t}),this.refresh()},changePaginator:function(e,t){this.queryParams=Object.assign(this.queryParams,{offset:e,limit:t}),this.refresh()},onTabChange:function(e){this.activeTabKey=e,this.refresh()},onChange:function(e){this.refresh()},loadData:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,a,i,r,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.loading=!0,"1"!==e.activeTabKey){t.next=11;break}return t.next=4,Object(c["j"])(e.queryParams);case 4:n=t.sent,a=n.items,i=n.paginator,e.plans=a,e.paginator=i,t.next=18;break;case 11:return t.next=13,Object(c["f"])(e.queryParams);case 13:r=t.sent,s=r.items,o=r.paginator,e.playBacks=s,e.paginator=o;case 18:e.loading=!1;case 19:case"end":return t.stop()}}),t)})))()},handleCancel:function(){this.visible=!1},handleOk:function(){var e=this,t=this.$refs.recordFormModal.model;this.confirmLoading=!0;var n=this.$refs.recordFormModal;n.$refs.recordPlanDialogForm.validate((function(a){if(!a)return e.confirmLoading=!1,!1;var i=n.$refs.recordPlan.getPlan();t.plan_ranges=i,console.log("model:",t),t.id?Object(c["e"])(t.id,t).then((function(t){e.$message.success("修改成功"),e.visible=!1,e.confirmLoading=!1,e.refresh()})).catch((function(t){e.confirmLoading=!1})):Object(c["a"])(t).then((function(t){e.$message.success("添加成功"),e.visible=!1,e.confirmLoading=!1,e.refresh()})).catch((function(t){e.confirmLoading=!1}))}))},refresh:function(){this.resetData(),this.loadData()},handleAddPlan:function(){this.$refs.recordFormModal.resetForm(),this.visible=!0,this.confirmLoading=!1,this.$refs.recordFormModal.initRecordPlan()},handlePlanEdit:function(e){this.$refs.recordFormModal.loadPlan(e),this.visible=!0,this.confirmLoading=!1},handlePlanSummary:function(e){this.$refs.summaryModal.initData(e),this.visibleSummary=!0,this.summaryLoading=!1},delPlan:function(e){var t=this;this.$confirm({title:"确认删除该计划?",onOk:function(){return Object(r["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:Object(c["d"])(e).then((function(e){t.$message.success("操作成功"),t.refresh()})).catch((function(e){}));case 1:case"end":return n.stop()}}),n)})))()},onCancel:function(){},class:"test"})},onSelectChange:function(e,t){this.selectedRowKeys=e,this.selectedRows=t,this.disabled=!1},resetData:function(){this.selectedRowKeys=[],this.selectedRows=[],this.disabled=!1,this.queryParams=Object.assign(d,{}),this.paginator=null},startPlayBack:function(e){var t=this;this.$confirm({title:"确定要开启录像?",onOk:function(){return Object(r["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:Object(c["l"])(e).then((function(e){setTimeout((function(){t.$message.success("操作成功"),t.refresh()}),1e3)})).catch((function(e){}));case 1:case"end":return n.stop()}}),n)})))()},onCancel:function(){}})},closePlayBack:function(e){var t=this;this.$confirm({title:"确定要关闭录像?",onOk:function(){return Object(r["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:Object(c["b"])(e).then((function(e){t.$message.success("操作成功"),t.refresh()})).catch((function(e){}));case 1:case"end":return n.stop()}}),n)})))()},onCancel:function(){}})},delPlayBack:function(e){var t=this;this.$confirm({title:"清空不能恢复，请确认是否清空录像?",onOk:function(){return Object(r["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:Object(c["c"])(e).then((function(e){t.$message.success("操作成功"),t.refresh()})).catch((function(e){}));case 1:case"end":return n.stop()}}),n)})))()},onCancel:function(){}})}},filters:{filterTime:function(e){return o()(e).format("YYYY-MM-DD HH:mm")},statusTypeFilter:function(e){var t={false:"warning",true:"success"};return t[e]}}},h=f,m=(n("2907"),n("2877")),p=Object(m["a"])(h,a,i,!1,null,"ec4b6e34",null);t["default"]=p.exports},"77f9":function(e,t,n){"use strict";n("cefd")},c486:function(e,t,n){},cefd:function(e,t,n){},d613:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.page?n("a-pagination",e._b({ref:"page",staticClass:"my-1 pagination",attrs:{"page-size-options":e.pageSizes,total:e.page.total,"show-size-changer":e.showSizeChanger,"show-quick-jumper":e.showQuickJumper,"show-total":function(e){return"共 "+e+" 条"},"page-size":e.perPage},on:{"update:pageSize":function(t){e.perPage=t},"update:page-size":function(t){e.perPage=t},change:e.onChange,showSizeChange:e.onSizeChange},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}},"a-pagination",e.$attrs,!1)):e._e()},i=[],r=(n("d3b7"),n("25f0"),n("99af"),{name:"LzPagination",data:function(){return{currentPage:1,perPage:15}},props:{page:Object,autoPush:{type:Boolean,default:!1},showSizeChanger:{type:Boolean,default:!0},showQuickJumper:{type:Boolean,default:!0}},computed:{pageSizes:function(){var e=["15","30","50","100","200"],t=this.page.perPage.toString();return-1===e.indexOf(t)?[t].concat(e):e}},methods:{push:function(e){var t=e.page,n=e.perPage,a=Object.assign({},this.$route.query,{offset:t||this.currentPage,limit:n||this.perPage});this.$router.push({path:this.$route.path,query:a})},onSizeChange:function(e,t){this.$emit("showSizeChange",e,t),this.autoPush&&(this.currentPage=1,this.push({page:1,perPage:t}))},onChange:function(e,t){this.$emit("change",e,t),this.autoPush&&this.push({page:e})}},watch:{page:{handler:function(e){e&&(this.currentPage=e.currentPage,this.perPage=e.perPage)},immediate:!0}}}),s=r,o=(n("77f9"),n("2877")),c=Object(o["a"])(s,a,i,!1,null,"0efa4349",null);t["a"]=c.exports},d754:function(e,t,n){},e5bf:function(e,t,n){"use strict";n.d(t,"j",(function(){return i})),n.d(t,"a",(function(){return r})),n.d(t,"e",(function(){return s})),n.d(t,"h",(function(){return o})),n.d(t,"d",(function(){return c})),n.d(t,"i",(function(){return l})),n.d(t,"f",(function(){return u})),n.d(t,"g",(function(){return d})),n.d(t,"k",(function(){return f})),n.d(t,"l",(function(){return h})),n.d(t,"b",(function(){return m})),n.d(t,"c",(function(){return p}));var a=n("28de");function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a["b"].get("record/plans",{params:e})}function r(e){return a["b"].promisePost("record/addPlan",e)}function s(e,t){return a["b"].promisePost("record/editPlan",t,{params:{id:e}})}function o(e){return a["b"].get("record/plan",{params:{id:e}})}function c(e){return a["b"].promisePost("record/delPlan",{id:e})}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a["b"].get("record/planItems",{params:e})}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a["b"].get("record/recordChannels",{params:e})}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a["b"].get("record/files",{params:e})}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a["b"].get("record/summary",{params:e})}function h(e){return a["b"].promisePost("record/startPlayBack",{video_id:e})}function m(e){return a["b"].promisePost("record/closePlayBack",{video_id:e})}function p(e){return a["b"].promisePost("record/delPlayBack",{video_id:e})}}}]);
//# sourceMappingURL=chunk-3599e5d8.800f63ab.js.map